vrrp_script haproxy-check {
    script "/usr/bin/killall -0 haproxy"
    interval 2
    weight 20
}

vrrp_instance haproxy-vip {
    state BACKUP
    priority {{ HOST_IP[inventory_hostname].split(".")[-1] }}
    interface {{iface.stdout}}
    virtual_router_id {{ HOST_IP[inventory_hostname].split(".")[-1] }}
    advert_int 3
    unicast_src_ip {{HOST_IP[inventory_hostname]}}
    unicast_peer {
{% for value in HOST_IP.values() %}
        {{value}}
{% endfor %}
    }
    virtual_ipaddress {
        {{APISERVER_IP}}
    }
    track_script {
        haproxy-check weight 20
    }
}
