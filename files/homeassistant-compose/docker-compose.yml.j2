services:
  homeassistant:
    image: "{{ image }}:{{ version }}"
    container_name: "{{ service }}"
    restart: unless-stopped
    network_mode: host
    privileged: true
    environment:
      TZ: "America/Los_Angeles"
    volumes:
      - "{{ home }}/config:/config"
      - "/etc/localtime:/etc/localtime:ro"
    devices:
      # HubZ Smart Home Controller - Z-Wave (if00) and Zigbee (if01)
      - "/dev/serial/by-id/usb-Silicon_Labs_HubZ_Smart_Home_Controller_61600611-if00-port0:/dev/ttyUSB0"
      - "/dev/serial/by-id/usb-Silicon_Labs_HubZ_Smart_Home_Controller_61600611-if01-port0:/dev/ttyUSB1"
    healthcheck:
      test: ["CMD-SHELL", "curl -sf http://localhost:{{ port }}/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
